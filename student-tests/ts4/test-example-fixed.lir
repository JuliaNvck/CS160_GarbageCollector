funptr make_node: &(int, &tree) -> &tree
funptr sum_tree: &(&tree) -> int

struct tree {
  children: [&tree]
  parent: &tree
  val: int
}

fn main() -> int {
let _const_0:int, _const_1:int, _const_2:int, _const_4:int, _const_n1:int, _inner3:&[&tree], _inner5:&&tree, _inner6:&int, _tmp1:&tree, _tmp2:int, _tmp4:[&tree], a:&tree, b:&tree, c:&tree, d:&tree, i:int, t:int

entry:
  _const_0 = $const 0
  _const_1 = $const 1
  _const_2 = $const 2
  _const_4 = $const 4
  _const_n1 = $const -1
  a = $call make_node(_const_0, __NULL)
  b = $copy a
  $jump lbl1

lbl1:
  _tmp2 = $cmp lt i _const_4
  $branch _tmp2 lbl2 lbl3

lbl2:
  _tmp1 = $call make_node(i, b)
  _inner3 = $gfp b tree::children
  _tmp4 = $load _inner3
  _inner5 = $gep _tmp4 _const_0 [true]
  _tmp4 = $copy __NULL
  $store _inner5 _tmp1
  _tmp1 = $copy __NULL
  _inner3 = $gfp b tree::children
  _tmp4 = $load _inner3
  _inner5 = $gep _tmp4 _const_0 [true]
  _tmp4 = $copy __NULL
  b = $load _inner5
  _tmp2 = $arith add i _const_1
  i = $copy _tmp2
  $jump lbl1

lbl3:
  b = $copy a
  i = $copy _const_0
  $jump lbl4

lbl4:
  _tmp2 = $cmp lt i _const_4
  $branch _tmp2 lbl5 lbl6

lbl5:
  _tmp1 = $call make_node(i, b)
  _inner3 = $gfp b tree::children
  _tmp4 = $load _inner3
  _inner5 = $gep _tmp4 _const_1 [true]
  _tmp4 = $copy __NULL
  $store _inner5 _tmp1
  _tmp1 = $copy __NULL
  _inner3 = $gfp b tree::children
  _tmp4 = $load _inner3
  _inner5 = $gep _tmp4 _const_1 [true]
  _tmp4 = $copy __NULL
  b = $load _inner5
  _tmp2 = $arith add i _const_1
  i = $copy _tmp2
  $jump lbl4

lbl6:
  _tmp2 = $call sum_tree(a)
  t = $copy _tmp2
  _inner3 = $gfp a tree::children
  _tmp4 = $load _inner3
  _inner5 = $gep _tmp4 _const_0 [true]
  _tmp4 = $copy __NULL
  _tmp1 = $load _inner5
  _inner3 = $gfp _tmp1 tree::children
  _tmp1 = $copy __NULL
  _tmp4 = $load _inner3
  _inner5 = $gep _tmp4 _const_0 [true]
  _tmp4 = $copy __NULL
  b = $load _inner5
  _inner5 = $gfp b tree::parent
  $store _inner5 __NULL
  _inner3 = $gfp a tree::children
  _tmp4 = $load _inner3
  _inner5 = $gep _tmp4 _const_1 [true]
  _tmp4 = $copy __NULL
  c = $load _inner5
  _inner5 = $gfp c tree::parent
  $store _inner5 __NULL
  a = $copy __NULL
  a = $alloc_single tree
  _inner6 = $gfp a tree::val
  $store _inner6 _const_n1
  _tmp4 = $alloc_array _const_2 &tree
  _inner3 = $gfp a tree::children
  $store _inner3 _tmp4
  _tmp4 = $copy __NULL
  _inner3 = $gfp c tree::children
  _tmp4 = $load _inner3
  _inner5 = $gep _tmp4 _const_1 [true]
  _tmp4 = $copy __NULL
  c = $load _inner5
  d = $alloc_single tree
  _tmp4 = $alloc_array _const_4 &tree
  _inner3 = $gfp d tree::children
  $store _inner3 _tmp4
  _tmp4 = $copy __NULL
  $ret _const_0
}

fn make_node(val:int, parent:&tree) -> &tree {
let _const_0:int, _const_2:int, _inner2:&int, _inner5:&[&tree], _inner8:&&tree, _tmp1:&tree, _tmp3:int, _tmp4:int, _tmp6:[&tree], _tmp7:int, a:&tree

entry:
  _const_0 = $const 0
  _const_2 = $const 2
  _tmp1 = $alloc_single tree
  a = $copy _tmp1
  _inner2 = $gfp a tree::val
  _tmp3 = $load _inner2
  _tmp4 = $cmp ne _tmp3 _const_0
  _tmp3 = $copy _tmp4
  $branch _tmp3 lbl5 lbl4

lbl1:
  $ret __NULL

lbl2:
  $jump lbl3

lbl3:
  _inner2 = $gfp a tree::val
  $store _inner2 val
  _tmp6 = $alloc_array _const_2 &tree
  _inner5 = $gfp a tree::children
  $store _inner5 _tmp6
  _inner8 = $gfp a tree::parent
  $store _inner8 parent
  $ret a

lbl4:
  _inner5 = $gfp a tree::children
  _tmp6 = $load _inner5
  _tmp4 = $cmp ne _tmp6 __NULL
  _tmp7 = $copy _tmp4
  $branch _tmp7 lbl7 lbl6

lbl5:
  $branch _tmp3 lbl1 lbl2

lbl6:
  _inner8 = $gfp a tree::parent
  _tmp1 = $load _inner8
  _tmp4 = $cmp ne _tmp1 __NULL
  _tmp7 = $copy _tmp4
  $jump lbl7

lbl7:
  _tmp3 = $copy _tmp7
  $jump lbl5
}

fn sum_tree(r:&tree) -> int {
let _const_0:int, _const_1:int, _inner2:&int, _inner3:&[&tree], _inner5:&&tree, _tmp1:int, _tmp4:[&tree], _tmp6:&tree, _tmp7:int, _tmp8:int

entry:
  _const_0 = $const 0
  _const_1 = $const 1
  _tmp1 = $cmp eq r __NULL
  $branch _tmp1 lbl1 lbl2

lbl1:
  $ret _const_0

lbl2:
  $jump lbl3

lbl3:
  _inner2 = $gfp r tree::val
  _tmp1 = $load _inner2
  _inner3 = $gfp r tree::children
  _tmp4 = $load _inner3
  _inner5 = $gep _tmp4 _const_0 [true]
  _tmp6 = $load _inner5
  _tmp7 = $call sum_tree(_tmp6)
  _tmp8 = $arith add _tmp1 _tmp7
  _inner3 = $gfp r tree::children
  _tmp4 = $load _inner3
  _inner5 = $gep _tmp4 _const_1 [true]
  _tmp6 = $load _inner5
  _tmp7 = $call sum_tree(_tmp6)
  _tmp1 = $arith add _tmp8 _tmp7
  $ret _tmp1
}

